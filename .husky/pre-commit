#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# ê¸°ì¡´ lint-staged ì‹¤í–‰
npm run pre-commit

# í™˜ê²½ ë³€ìˆ˜ ì²´í¬
echo "ğŸ” Checking environment variables..."
npm run env:check

# Supabase íƒ€ì… ì²´í¬
echo "ğŸ”„ Checking Supabase types..."
npm run db:types:check

# ë³€ê²½ì‚¬í•­ì´ ìˆìœ¼ë©´ ìë™ìœ¼ë¡œ ì¶”ê°€
if git diff --quiet src/types/database.types.ts; then
  echo "âœ… Supabase types are up to date"
else
  echo "ğŸ“ Supabase types updated, adding to commit..."
  git add src/types/database.types.ts
fi

# ë¯¼ê°í•œ ì •ë³´ ìŠ¤ìº”
echo "ğŸ”’ Scanning for sensitive information..."
npm run security:scan

# ì‘ì—… ì„¸ì…˜ì— ì»¤ë°‹ ê¸°ë¡
if [ -f ".taskmaster/sessions/current-session.json" ]; then
  COMMIT_MSG=$(git log -1 --pretty=%B)
  node scripts/ai-session.js note "Commit: $COMMIT_MSG"
fi
